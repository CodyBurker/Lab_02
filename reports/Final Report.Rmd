---
title: "Research Proposal: How are state policies and population related to the state-wide spread of COVID-19?"
author: 'Cody Burker, Emily Fernandes, Margo Suryanaga'
output: bookdown::pdf_document2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Background

The COVID-19 pandemic is the first pandemic seen in a century, affecting each individual worldwide. While many countries issued lockdowns, travel quarantines, and other COVID-19 restrictions on a federal level, the US federal government placed the power with the governors to regulate the implementation of these restrictions on a state-by-state basis.

There has been increased skepticism on the true effectiveness of restrictions in slowing down the spread of COVID-19, especially due to the amount of economic impact resulting from these procedures. Evaluating how each state's population density, lockdown procedures, and facemask policies correlates to the spread of COVID-19 within that state helps citizens understand the importance of following these policies. Understanding the effectiveness of COVID-19 restrictions in slowing the spread of the disease also helps policy makers justify the implementation of these policies to their constituents. Additionally, this information might be of interest to public health officials who are looking for best practices to contain a future pandemic or infectious disease.

# Data sources

1.  [COVID-19 US State Policy Database](www.tinyurl.com/statepolicies) A database of state policy responses to the pandemic, compiled by researchers at the Boston University School of Public Health.
2.  [NY Times Covid-19 Data Repository](https://github.com/nytimes/covid-19-data) A series of data files with cumulative counts of coronavirus cases in the United States, at the state and county level, over time.

From data source (1), we expect to get:\
- Closure and reopenings: Start and end dates of closures of public spaces\
- Stay at home: Start and end dates of stay at home policies\
- Face masks: Start and end date of face mask mandates\
From data source (2) we expect to get:\
- Weekly COVID-19 case counts

# Methodology and Expected outcome

We will investigate the causal effect that various variables have on the 7-day moving average of cumulative COVID-19 cases. We will model the 7-day moving average of cumulative COVID-19 cases as a linear function of:\
- Closure and reopenings (whether a stay-at-home order was in effect at that time in that state and how many days since it has started)\
- When mask mandates were required (as an indicator variable, and as how many days since the mandate started)\
- Whether the state implemented legal consequences for violating stay-at-home orders\
We will assume that these variables have no effect on COVID-19 cases, and will construct tests to investigate whether a relationship exists.

# Regression Table

Table \@ref(tab:regression) displays the regression of all 3 models. 

```{r warning=TRUE, include=FALSE}
# Run Margo's file to load models into memory:

#### CHANGE ME ####################
## Set working directory to where git was cloned to
source_file = file("~/MIDS 203/Lab_02_SSH/src/data/lab2_MJS.R")
# Also change the 
###################################
# Run Margo's file.
source(source_file)
```

```{r regression, echo=FALSE, message=FALSE, warning=FALSE, results="asis"}
# Assumes that the following models are in-memory:
# model1
# model2
# model3
library(stargazer)
library(sandwich)
library(lmtest)
library(tidyverse)

# Adjust standard errors
cov1 <- vcovHC(model1)
rse1 <- sqrt(diag(cov1))
cov2 <- vcovHC(model2)
rse2 <- sqrt(diag(cov2))
cov3 <- vcovHC(model3)
rse3 <- sqrt(diag(cov3))

se_1 <- coeftest(model1,vcov. = cov1)
se_2 <- coeftest(model2,vcov. = cov2)
se_3 <- coeftest(model3,vcov. = cov3)

# Get new f statistics
f_stat1 <- waldtest(model1, vcov = cov1)
f_stat2 <- waldtest(model2, vcov = cov2)
f_stat3 <- waldtest(model3, vcov = cov3)

# Create string array of modified F statistic
f_stat_string = c("F-Statistic",
                        paste(round(f_stat1$F[2],3),"***"," (df = 1; 49)", sep=""),
                        paste(round(f_stat1$F[2],3),"***"," (df = 5; 45)", sep=""),
                        paste(round(f_stat3$F[2],3),"***"," (df = 9; 41)", sep="")
           )

stargazer(model1, model2, model3, type="latex",
          title = "Regression Table",
          covariate.labels = c("Log Population Density",
                               "Restaurant Shutdown Length (days)",
                               "Gym Shutdown Length (days)",
                               "Business Facemask Length (days)",
                               "Traveler Quarantine Length (days)",
                               "School Shutdown Length (days)",
                               "Stay at Home Order Length (days)",
                               "Bar Shutdown Length (days)",
                               "Shutdown Speed after Pandemic (days)",
                               "State of Emergency Speed (days)"
                               ),
          dep.var.labels = c(""),
          dep.var.caption = "Dependent Variable: Log Covid-19 Cases",
          column.labels = c("Simple Model","Moderate Model","Complex Model"),
          se = list(rse1, rse2, rse3),
          omit.stat = "f",
          add.lines = list(f_stat_string),
          header=FALSE,
          label = "tab:regression"
)
```
## Model 1

We will begin by inspecting the first Model in Table \@ref(tab:regression).

```{r echo=FALSE, message=FALSE, warning=FALSE}
table3_winterOnly %>%
  ggplot(aes(x = Population_density_log,
           y = inc_cases_log)) + 
  geom_point() + 
  geom_smooth(method="lm", se = FALSE) + 
  labs(title = "Model 1: Log Population Density vs Log Covid-19 Cases",
       x = "Log Population Density" , y = "Log Covid-19 Cases")
```

## Model 2

## Model 3